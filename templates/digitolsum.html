
{% extends 'base.html' %}
{% block title %}บันทึกรายรับรายจ่าย{% endblock %}
{% block content %}
<h2>บันทึกรายรับรายจ่าย</h2>
=======
{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
	<h2 class="mb-3">ตารางรายรับ - รายจ่าย</h2>
	<form method="post" action="{% url 'slip' %}">
		{% csrf_token %}
		<table class="table table-bordered">
			<thead class="table-success">
				<tr>
					<th>รายการ</th>
					<th>ประเภท</th>
					<th>จำนวนเงิน (บาท)</th>
				</tr>
			</thead>
			<tbody id="income-expense-table">
				<tr>
					<td><input type="text" name="item_1" class="form-control" required></td>
					<td>
						<select name="type_1" class="form-select">
							<option value="income">รายรับ</option>
							<option value="expense">รายจ่าย</option>
						</select>
					</td>
					<td><input type="number" name="amount_1" class="form-control" required></td>
				</tr>
			</tbody>
		</table>
		<button type="button" class="btn btn-outline-success mb-2" onclick="addRow()">เพิ่มรายการ</button>
		<hr>
		<div class="mb-3">
			<label>รวมรายรับ: <span id="total-income">0</span> บาท</label><br>
			<label>รวมรายจ่าย: <span id="total-expense">0</span> บาท</label><br>
			<label>คงเหลือ: <span id="balance">0</span> บาท</label>
		</div>
		<button type="submit" class="btn btn-primary">สรุปผลและส่งข้อมูล</button>
	</form>
</div>
<script>
let rowCount = 1;
function addRow() {
	rowCount++;
	const table = document.getElementById('income-expense-table');
	const row = document.createElement('tr');
	row.innerHTML = `
		<td><input type="text" name="item_${rowCount}" class="form-control" required></td>
		<td>
			<select name="type_${rowCount}" class="form-select">
				<option value="income">รายรับ</option>
				<option value="expense">รายจ่าย</option>
			</select>
		</td>
		<td><input type="number" name="amount_${rowCount}" class="form-control" required></td>
	`;
	table.appendChild(row);
}

document.addEventListener('input', function() {
	let totalIncome = 0;
	let totalExpense = 0;
	for (let i = 1; i <= rowCount; i++) {
		const type = document.querySelector(`[name='type_${i}']`);
		const amount = document.querySelector(`[name='amount_${i}']`);
		if (type && amount && amount.value) {
			if (type.value === 'income') {
				totalIncome += parseFloat(amount.value);
			} else {
				totalExpense += parseFloat(amount.value);
			}
		}
	}
	document.getElementById('total-income').textContent = totalIncome;
	document.getElementById('total-expense').textContent = totalExpense;
	document.getElementById('balance').textContent = totalIncome - totalExpense;
});
</script>

{% endblock %}
